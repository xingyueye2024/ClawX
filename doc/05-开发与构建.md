# 开发与构建

## 1. 环境要求

| 工具 | 版本要求 |
|------|----------|
| Node.js | 22+ |
| pnpm | 最新版 |
| Python | 3.10+（由 uv 管理） |

## 2. 开发命令

```bash
# 安装依赖
pnpm install

# 开发模式（热重载）
pnpm dev

# 生产构建
pnpm build

# 代码检查
pnpm lint

# 运行测试
pnpm test           # 单元测试（Vitest）
pnpm test:e2e       # E2E 测试（Playwright）
```

## 3. 打包与分发

### 平台构建

```bash
# macOS
pnpm package:mac

# Windows
pnpm package:win

# Linux
pnpm package:linux
```

### 发布

```bash
# 构建并发布到 GitHub Releases
pnpm release
```

### 构建产物

| 平台 | 格式 |
|------|------|
| macOS | DMG、.app 包 |
| Windows | NSIS 安装程序、便携版 |
| Linux | AppImage、deb、rpm |

## 4. 构建流程

1. **`vite build`** — 编译 React 应用
2. **`bundle-openclaw.mjs`** — 将 OpenClaw 运行时打包到 resources
3. **`electron-builder`** — 为目标平台打包

### 内嵌资源

构建时会自动打包以下资源：
- OpenClaw 运行时（Python + 依赖）
- uv 二进制文件（平台特定）
- ClawHub CLI
- 默认技能包
- 提供商图标与静态资源

## 5. 测试体系

| 类型 | 工具 | 用途 |
|------|------|------|
| 单元测试 | Vitest | 组件与逻辑单元测试 |
| E2E 测试 | Playwright | 端到端功能测试 |

## 6. 代码规范

| 工具 | 用途 |
|------|------|
| ESLint | 代码质量检查与风格统一 |
| Prettier | 代码格式化 |
| TypeScript | 类型安全 |

## 7. 自动更新

ClawX 集成了 `electron-updater` 自动更新机制：

- **更新频道** — 支持 Stable（稳定版）、Beta（测试版）、Dev（开发版）
- **后台下载** — 更新包在后台自动下载
- **通知安装** — 下载完成后通知用户安装
- **手动检查** — 用户可随时手动检查更新

## 8. 平台适配

### macOS
- 自定义红绿灯按钮位置
- Electron Helper 进程处理，避免多余 Dock 图标
- 支持安装 `openclaw` 全局 CLI 命令

### Windows
- 自定义标题栏
- PowerShell CLI 命令说明

### Linux
- 标准窗口控制
- CLI 命令支持
